<h2>List of TimeInvoices</h2>
<div class="box tabular">
  <% if User.current.allowed_to_globally?(:generate_time_invoices, {}) %>
    <%= link_to 'Generate a new invoice', :controller=>'time_invoices',:action=>'topnew'%><br/>
  <% end %>
  <%= link_to 'View Time Invoice Report', :controller=>'time_invoice_reports',:action=>'index'%><br/><br/>
  <% if @time_invoices.empty? %>
    <br/><strong><%= 'No TimeInvoices to show yet' %></strong>
  <%else%>
    <table class="list issues">
      <tr><th>ID</th><th>Start Date</th> <th>End Date</th> 
        <th>Invoice Submitter</th> <th>Project Name</th> <th>Remarks</th>
        <th>Action</th>
      </tr>
      <%  @time_invoices.each do |ti| %>      
        <tr class="<%= cycle("odd", "even")%> issue">
          <td class="id">
            <%=  ti.id%>          
          </td>
          <td>
            <%=  ti.start_date%>
          </td>
          <td>
            <%=  ti.end_date%>
          </td>
          <td>
            <%=  ti.submitted_by && (link_to ti.submitted_by.name,user_path(ti.submitted_by.id))%>
          </td>
          <td>
            <%=  link_to ti.project.name, project_path(ti.project.id) %>
          </td>
          <td>
            <%=  ti.comment %>
          </td>
          <%if ti.submitted_by %>
            <td>
              <%=  link_to 'View', ti%>
              <% if User.current.allowed_to? :edit_invoiceable_time, ti.project %>
                | <%=  link_to 'Edit/Submit', edit_time_invoice_path(ti) %>
              <% end %>
            </td>
          <%else%>
            <td>
              <% if User.current.allowed_to?(:submit_invoiceable_time, ti.project) %>
                <%=  link_to 'Edit/Submit', edit_time_invoice_path(ti) %>
              <% end %>
            </td>
          <%end%>          
        </tr>
      <%end%>
    </table>
  <%end%>
</div>